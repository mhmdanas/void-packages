# Template file for 'botan3'
pkgname=botan3
version=3.2.0
revision=1
build_style=gnu-makefile
hostmakedepends="doxygen python3"
makedepends="bzip2-devel liblzma-devel sqlite-devel zlib-devel"
short_desc="Crypto library written in C++"
maintainer="Orphaned <orphan@voidlinux.org>"
license="BSD-2-Clause"
homepage="https://botan.randombit.net/"
changelog="https://botan.randombit.net/news.html"
distfiles="https://botan.randombit.net/releases/Botan-${version}.tar.xz"
checksum=049c847835fcf6ef3a9e206b33de05dd38999c325e247482772a5598d9e5ece3
python_version=3

LDFLAGS="-pthread"

do_configure() {
	local _args _cpu

	_args="--prefix=/usr --os=linux --with-doxygen --with-bzip2 --with-lzma
	 --with-zlib --with-sqlite3 --cc=gcc --build-targets cli
	 --build-targets shared --build-targets static"

	if [ "$XBPS_CHECK_PKGS" ]; then
		_args+=" --build-targets tests"
	fi

	case "$XBPS_TARGET_MACHINE" in
	i686*)
		_cpu="i686"
		;;
	x86_64*)
		_cpu="x86_64"
		;;
	armv[56]*)
		_cpu="arm"
		_args+=" --disable-modules=simd"
		;;
	armv7*)
		_cpu="armv7-a"
		_args+=" --disable-modules=simd"
		;;
	aarch64*)
		_cpu="armv8-a"
		;;
	mips*)
		_cpu="mips32"
		;;
	ppc64le*)
		_cpu="ppc64le"
		;;
	ppc64*)
		_cpu="ppc64"
		;;
	ppc*)
		_cpu="ppc"
		;;
	*)
		_cpu="${XBPS_TARGET_MACHINE%-musl}"
		;;
	esac

	python3 configure.py \
		--distribution-info="Void Linux botan-${version}_${revision}" \
		--cpu=${_cpu} \
		${_args}
}

post_install() {
	vlicense license.txt
	mv ${DESTDIR}/usr/bin/botan{,3}
}

botan3-doc_package() {
	short_desc+=" - documentation"
	pkg_install() {
		vmove usr/share/doc
	}
}

botan3-devel_package() {
	short_desc+=" - development files"
	depends="${makedepends} ${sourcepkg}>=${version}_${revision}"
	pkg_install() {
		vmove usr/include
		vmove "usr/lib/*.a"
		vmove "usr/lib/*.so"
		vmove usr/lib/pkgconfig
	}
}
